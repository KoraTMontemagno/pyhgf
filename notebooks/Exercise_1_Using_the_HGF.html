

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Hierarchical Gaussian Filter modelling exercises &#8212; pyhgf 0.0.3 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/Exercise_1_Using_the_HGF';</script>
    <link rel="shortcut icon" href="../_static/logo_small.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_small.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo_small.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">pyhgf</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../theory.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cite.html">
                        Cite
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../references.html">
                        References
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ilabcode/pyhgf" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/legrandni" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/pyhgf/" title="Pypi" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-box"></i></span>
            <label class="sr-only">Pypi</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../theory.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cite.html">
                        Cite
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../references.html">
                        References
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ilabcode/pyhgf" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/legrandni" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/pyhgf/" title="Pypi" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-box"></i></span>
            <label class="sr-only">Pypi</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Hierarchical Gaussian Filter modelling exercises</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="hierarchical-gaussian-filter-modelling-exercises">
<span id="hgf-exercises"></span><h1>Hierarchical Gaussian Filter modelling exercises<a class="headerlink" href="#hierarchical-gaussian-filter-modelling-exercises" title="Permalink to this heading">#</a></h1>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
import sys
if &#39;google.colab&#39; in sys.modules:
    ! pip install pyhgf
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyhgf</span> <span class="kn">import</span> <span class="n">load_data</span>
<span class="kn">from</span> <span class="nn">pyhgf.model</span> <span class="kn">import</span> <span class="n">HGF</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>

<span class="c1"># load example dataset</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s2">&quot;continuous&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In this notebook you are going to learn the core principles on which the HGF is built, you will build agents that can filter new observations and update their beliefs about hidden states of the world and try to optimize them so they are getting less and less surprised about what is happening. Finally, you will create an agent that tries to optimize its behaviour when facing (almost) unpredictable events.</p>
<section id="theory-modeling-belief-updating-under-uncertainty">
<h2>Theory: Modeling belief updating under uncertainty<a class="headerlink" href="#theory-modeling-belief-updating-under-uncertainty" title="Permalink to this heading">#</a></h2>
<section id="gaussian-random-walks">
<h3>Gaussian random walks<a class="headerlink" href="#gaussian-random-walks" title="Permalink to this heading">#</a></h3>
<p>The generative model on which the HGF is built is a generalisation of the <a class="reference external" href="https://en.wikipedia.org/wiki/Random_walk#Gaussian_random_walk">Gaussian Random Walk</a> (GRW). A GRW generate a new observation <span class="math notranslate nohighlight">\(x_1^{(k)}\)</span> at each time step <span class="math notranslate nohighlight">\(k\)</span> from a normal distribution and using the previous observation <span class="math notranslate nohighlight">\(x_1^{(k-1)}\)</span> such as:</p>
<div class="math notranslate nohighlight">
\[
x_1^{(k)} \sim \mathcal{N}(x_1^{(k-1)}, \sigma^2)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma^2\)</span> is the variance of the distribution.</p>
<div class="admonition-exercise-1 admonition">
<p class="admonition-title">Exercise 1</p>
<p>Using the equation above, write a Python code that implements a Gaussian random walk using the following parameters: <span class="math notranslate nohighlight">\(\sigma^2 = 1\)</span> and <span class="math notranslate nohighlight">\(x_1^{(0)} = 0\)</span>.</p>
</div>
</section>
<section id="volatility-coupling">
<h3>Volatility coupling<a class="headerlink" href="#volatility-coupling" title="Permalink to this heading">#</a></h3>
<p>The HGF hierarchically generalize the GRW by making the parameters of a stochastic process depend on another GRW at a higher level. This kind of dependency is termed “coupling” and can target the volatility (<span class="math notranslate nohighlight">\(\sigma^2\)</span>) or the value (<span class="math notranslate nohighlight">\(\mu\)</span>), or both.</p>
<p>If we take as an example the two-level continuous HGF <span id="id1">[<a class="reference internal" href="../references.html#id3" title="Christoph D. Mathys, Ekaterina I. Lomakina, Jean Daunizeau, Sandra Iglesias, Kay H. Brodersen, Karl J. Friston, and Klaas E. Stephan. Uncertainty in perception and the hierarchical gaussian filter. Frontiers in Human Neuroscience, 2014. URL: https://www.frontiersin.org/articles/10.3389/fnhum.2014.00825, doi:10.3389/fnhum.2014.00825.">Mathys <em>et al.</em>, 2014</a>]</span>, the model is constituted of two states of interest, <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>. The node <span class="math notranslate nohighlight">\(x_1\)</span> is performing a GRW, but it is also paired with <span class="math notranslate nohighlight">\(x_2\)</span> via <em>volatility coupling</em>. This means that for state <span class="math notranslate nohighlight">\(x_1\)</span>, the mean of the Gaussian random walk on time point <span class="math notranslate nohighlight">\(k\)</span> is given by its previous value <span class="math notranslate nohighlight">\(x_1^{(k-1)}\)</span>, while the step size (or variance) depends on the current value of the higher level state, <span class="math notranslate nohighlight">\(x_2^{(k)}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
x_1^{(k)} \sim \mathcal{N}(x_1^{(k-1)}, \, f(x_2^{(k)}))
\]</div>
<p>where the exact dependency is of the form</p>
<div class="math notranslate nohighlight">
\[
    f(x_2^{(k)}) = \exp(x_2^{(k)} + \omega_1)
\]</div>
<p>At the higher level of the hierarchy (here the second level), the nodes are not inheriting anything from their parents anymore, and only rely on their own variance:</p>
<div class="math notranslate nohighlight">
\[
x_2^{(k)} \sim \mathcal{N}(x_2^{(k-1)}, \, \exp(\omega_2))
\]</div>
<div class="admonition-exercise-2 admonition">
<p class="admonition-title">Exercise 2</p>
<p>Using the equation above and your previous implementation, write a Python code that implements a hierarchical Gaussian random walk with the following parameters: <span class="math notranslate nohighlight">\(\omega_1 = -6.0\)</span>, <span class="math notranslate nohighlight">\(\omega_2 = -6.0\)</span>, <span class="math notranslate nohighlight">\(\mu_1 = 0.0\)</span>, <span class="math notranslate nohighlight">\(\mu_2 = -2.0\)</span>, <span class="math notranslate nohighlight">\(x_{1} = 0.0\)</span> and <span class="math notranslate nohighlight">\(x_{2} = -2.0\)</span></p>
<p>What happens if you try different values of <span class="math notranslate nohighlight">\(\omega\)</span>?</p>
</div>
</section>
<section id="the-continuous-hgf">
<h3>The continuous HGF<a class="headerlink" href="#the-continuous-hgf" title="Permalink to this heading">#</a></h3>
<p>The pyhgf package implements this process with the corresponding update equation so the model can take as input a time series and infer the more likely generative structure that created the values. This can be extremely useful if you want to work with time series that have varying levels of volatility (i.e. meta-volatility). In the following example, we illustrate how we can use the Hierarchical Gaussian Filter to filter and predict inputs in a continuous node.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a sime two-levels continuous HGF with defaults parameters</span>
<span class="n">two_levels_continuous_hgf</span> <span class="o">=</span> <span class="n">HGF</span><span class="p">(</span>
    <span class="n">n_levels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
    <span class="n">initial_mu</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="mf">1.04</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
    <span class="n">initial_pi</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="mf">1e4</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="mf">1e1</span><span class="p">},</span>
    <span class="n">omega</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating a continuous Hierarchical Gaussian Filter with 2 levels.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_levels_continuous_hgf</span><span class="o">.</span><span class="n">plot_network</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/200d950df6b3a3efa6fb53a884de54c98e09df752f713fcc366790bb8384bb7b.svg" src="../_images/200d950df6b3a3efa6fb53a884de54c98e09df752f713fcc366790bb8384bb7b.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add new observations</span>
<span class="n">two_levels_continuous_hgf</span> <span class="o">=</span> <span class="n">two_levels_continuous_hgf</span><span class="o">.</span><span class="n">input_data</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">timeseries</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Add 614 new continuous observations.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_levels_continuous_hgf</span><span class="o">.</span><span class="n">plot_trajectories</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b56c6ab5a40d20770c96e2919ff29fe03d38bce1804389459ff5011990ea35e0.png" src="../_images/b56c6ab5a40d20770c96e2919ff29fe03d38bce1804389459ff5011990ea35e0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_levels_continuous_hgf</span><span class="o">.</span><span class="n">surprise</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array(-593.9536, dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise-3 admonition">
<p class="admonition-title">Exercise 3</p>
<p><span class="math notranslate nohighlight">\(\omega\)</span> represents the tonic part of the variance (the part that is not affected by the parent node). Using the code example above, create another model with different values for <span class="math notranslate nohighlight">\(\omega\)</span> at the second level. What is the consequence of changing this value on the beliefs trajectories? What is the “best” model in this context?</p>
</div>
</section>
<section id="parameters-optimization">
<h3>Parameters optimization<a class="headerlink" href="#parameters-optimization" title="Permalink to this heading">#</a></h3>
<p>So far we have been running the HGF forward by fixing the values of the parameters beforehand. We can also adopt an alternative approach and try to estimate the most likely value of a given parameter from an input time series (i.e. what would be the “best” agent in this context?). This can be done through Bayesian inference. Here we are going to use Hamiltonian Monte Carlo sampling using PyMC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyhgf.distribution</span> <span class="kn">import</span> <span class="n">HGFDistribution</span>
<span class="kn">from</span> <span class="nn">pyhgf.response</span> <span class="kn">import</span> <span class="n">first_level_gaussian_surprise</span>

<span class="n">hgf_logp_op</span> <span class="o">=</span> <span class="n">HGFDistribution</span><span class="p">(</span>
    <span class="n">n_levels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">input_data</span><span class="o">=</span><span class="p">[</span><span class="n">timeseries</span><span class="p">],</span>
    <span class="n">response_function</span><span class="o">=</span><span class="n">first_level_gaussian_surprise</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">two_level_hgf</span><span class="p">:</span>

    <span class="c1"># omegas priors</span>
    <span class="n">omega_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;omega_1&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="n">pm</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span>
        <span class="s2">&quot;hgf_loglike&quot;</span><span class="p">,</span>
        <span class="n">hgf_logp_op</span><span class="p">(</span>
            <span class="n">omega_1</span><span class="o">=</span><span class="n">omega_1</span><span class="p">,</span>
            <span class="n">omega_2</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">,</span>
            <span class="n">omega_input</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span>
            <span class="n">rho_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">rho_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">pi_1</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span>
            <span class="n">pi_2</span><span class="o">=</span><span class="mf">1e1</span><span class="p">,</span>
            <span class="n">mu_1</span><span class="o">=</span><span class="n">timeseries</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">mu_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">kappa_1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">omega_3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="n">rho_3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="n">pi_3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="n">mu_3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="n">kappa_2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">model_to_graphviz</span><span class="p">(</span><span class="n">two_level_hgf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/29feca12333e06bb418b5206275ace5b8c96f8cd05520bbac6adf3c3f1fad4d2.svg" src="../_images/29feca12333e06bb418b5206275ace5b8c96f8cd05520bbac6adf3c3f1fad4d2.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">two_level_hgf</span><span class="p">:</span>
    <span class="n">idata</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initializing NUTS using jitter+adapt_diag...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sequential sampling (2 chains in 1 job)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NUTS: [omega_1]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
    <div>
      <progress value='2000' class='' max='2000' style='width:300px; height:20px; vertical-align: middle;'></progress>
      100.00% [2000/2000 00:08&lt;00:00 Sampling chain 0, 0 divergences]
    </div>
    </div><div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
    <div>
      <progress value='2000' class='' max='2000' style='width:300px; height:20px; vertical-align: middle;'></progress>
      100.00% [2000/2000 00:06&lt;00:00 Sampling chain 1, 0 divergences]
    </div>
    </div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 15 seconds.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We recommend running at least 4 chains for robust computation of convergence diagnostics
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;Axes: title={&#39;center&#39;: &#39;omega_1&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;omega_1&#39;}&gt;]], dtype=object)
</pre></div>
</div>
<img alt="../_images/b8f5753a65662657ae27328903d44c551a7a0f726bbe5bbfb9a037e3164f20ff.png" src="../_images/b8f5753a65662657ae27328903d44c551a7a0f726bbe5bbfb9a037e3164f20ff.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>omega_1</th>
      <td>-6.334</td>
      <td>0.662</td>
      <td>-7.457</td>
      <td>-4.988</td>
      <td>0.022</td>
      <td>0.016</td>
      <td>886.0</td>
      <td>1039.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="practice-filtering-the-worlds-weather-to-optimize-behavior">
<h2>Practice: Filtering the worlds weather to optimize behavior<a class="headerlink" href="#practice-filtering-the-worlds-weather-to-optimize-behavior" title="Permalink to this heading">#</a></h2>
<p>In the previous section, we introduced the basic computational concept behind the Hierarchical Gaussian Filter and illustrated:</p>
<ol class="arabic simple">
<li><p>How to fit the HGF to a time series.</p></li>
<li><p>How to find the parameters that optimize a simple response function.</p></li>
</ol>
<p>In this section, we are going to apply this knowledge to more practical considerations and try to build agents that can optimize their behaviour under volatile sensory inputs. We will take the example of agents that experiences fluctuation in the weather and would like to optimize their behaviour (e.g. regarding whether or not they should carry an umbrella for the next day). Experiencing rain while not having an umbrella is extremely annoying for these agents (this elicits a lot of surprises), but carrying an umbrella in sunny weather is also annoying. You should therefore come up with a solution to help them optimise their decisions. For the exercise we will consider that the agents cannot just look by the windows and check the weather, they have to decide at least one day for the next or more, using their current understanding of the weather (i.e. their beliefs about the latent variables in the environment).</p>
<p>We will use data from <a href="#id2"><span class="problematic" id="id3">pfenninger:2016, staffell:2016</span></a> that is made available at the following database: https://renewables.ninja/. This database contains hourly recordings of various weather parameters that have been tracked over one year at a different positions in the world. You can explore the database and use the recording you like, you can also compare agents trained in different part of the globe. The procedure is the following:</p>
<ol class="arabic simple">
<li><p>Set the point or search for a location</p></li>
<li><p>Extend the weather button and check all boxes (if you wish to use the premade processing script) or select your data structure.</p></li>
<li><p>Press “run” and wait for the simulation to run</p></li>
<li><p>Save hourly output as CSV</p></li>
</ol>
<p>Alternatively, we provide here a data frame that can be easily loaded, it contains the weather parameters recorded in Aarhus:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aarhus_weather_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/ilabcode/hgf-data/main/datasets/weather.csv&quot;</span><span class="p">)</span>
<span class="n">aarhus_weather_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>t2m</th>
      <th>prectotland</th>
      <th>precsnoland</th>
      <th>snomas</th>
      <th>rhoa</th>
      <th>swgdn</th>
      <th>swtdn</th>
      <th>cldtot</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-01-01 00:00</td>
      <td>7.387</td>
      <td>0.124</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.249</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.931</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-01-01 01:00</td>
      <td>7.472</td>
      <td>0.200</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.247</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.865</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-01-01 02:00</td>
      <td>7.635</td>
      <td>0.196</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.244</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.701</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-01-01 03:00</td>
      <td>7.224</td>
      <td>0.061</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.245</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.387</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-01-01 04:00</td>
      <td>6.147</td>
      <td>0.018</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.250</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.128</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The data frame contains the following parameters, recorded every hour over the year of 2019:</p>
<ul class="simple">
<li><p>t2m: the 2-meter above ground level air temperature</p></li>
<li><p>prectotland : The rain precipitation rate (mm/hour)</p></li>
<li><p>precsnoland : Snow precipitation rate (mm/hour)</p></li>
<li><p>snomas : Total snow storage land (kg/m2)</p></li>
<li><p>rhoa : Air density at surface (kg/m3)</p></li>
<li><p>swgdn : Surface incoming shortwave flux (W/m2) (considering cloud cover) (The value at the surface is approximately 1000 W/m2 on a clear day at solar noon in the summer months)</p></li>
<li><p>swtdn : Toa (top of atmosphere) incoming shortwave flux (W/m2)</p></li>
<li><p>cldtot : Total cloud area fraction. An average over grid cells and summed over all height above ground ([0,1] scale where 0 is no cloud and 1 is very cloudy)</p></li>
</ul>
<div class="admonition-exercises-4 admonition">
<p class="admonition-title">Exercises 4</p>
<ul class="simple">
<li><p>Select a city and download a recording OR use the data frame loaded above.</p></li>
<li><p>Choose which weather variables to work with.</p></li>
<li><p>Set up an HGF structure and run it forward on the data.</p></li>
<li><p>Set up an agent who has to decide something based on the weather (to carry an umbrella, or how many layers of clothes they have to put on based on temperature, cloudiness etc. ) and incorporate meaningful HGF parameters in the model.</p></li>
<li><p>Compare the performances of two agents and interpret their differences. You have to choose what makes the two agents different: they can be trained on different data (e.g. from different cities, from different months…), have different HGF parameters, have different number of level, have different response functions (e.g. one agent can have pleasure carrying an umbrella when it is raining)… You can decide to optimize the parameters or not, this also depends on your hypothesis.</p></li>
</ul>
</div>
<p>To illustrate on possible workflow, we create an agent that tries to use the temperature to decide for taking an umbrella the next day. We use the first month of recording to train the agent:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load time series example data</span>
<span class="n">timeserie</span> <span class="o">=</span> <span class="n">aarhus_weather_df</span><span class="p">[</span><span class="s2">&quot;t2m&quot;</span><span class="p">][:</span><span class="mi">24</span><span class="o">*</span><span class="mi">30</span><span class="p">]</span>

<span class="c1"># This is where we define all the model parameters - You can control the value of</span>
<span class="c1"># different variables at different levels using the corresponding dictionary.</span>
<span class="n">hgf</span> <span class="o">=</span> <span class="n">HGF</span><span class="p">(</span>
    <span class="n">n_levels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
    <span class="n">initial_mu</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="n">timeserie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">},</span>
    <span class="n">initial_pi</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="mf">31e4</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="mf">1e1</span><span class="p">},</span>
    <span class="n">omega</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># add new observations</span>
<span class="n">hgf</span><span class="o">.</span><span class="n">input_data</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">timeserie</span><span class="p">)</span>

<span class="c1"># visualization of the belief trajectories</span>
<span class="n">hgf</span><span class="o">.</span><span class="n">plot_trajectories</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating a continuous Hierarchical Gaussian Filter with 2 levels.
Add 720 new continuous observations.
</pre></div>
</div>
<img alt="../_images/3977a369be3af96ab4be8700f873620a17aa0cff199923b4b879795306abd0df.png" src="../_images/3977a369be3af96ab4be8700f873620a17aa0cff199923b4b879795306abd0df.png" />
</div>
</div>
<section id="creating-an-agent">
<h3>Creating an agent<a class="headerlink" href="#creating-an-agent" title="Permalink to this heading">#</a></h3>
<p>Workflow of creating an agent with a response function:</p>
<ul class="simple">
<li><p>Get the trajectories from the hgf with the function <code class="docutils literal notranslate"><span class="pre">to_pandas()</span></code>.</p></li>
<li><p>Determine which states could be interesting to work with, and how they might influence decision making.</p></li>
<li><p>Set up a function taking the rows of the trajectories as inputs and return an action based on some comuptations you choose.</p></li>
</ul>
<p>The most important state trajecotories of the HGF.</p>
<ul class="simple">
<li><p>posterior mean: <span class="math notranslate nohighlight">\(\mu\)</span></p></li>
<li><p>posterior precision: <span class="math notranslate nohighlight">\(\pi\)</span></p></li>
<li><p>prediction mean: <span class="math notranslate nohighlight">\(\hat{\mu}\)</span></p></li>
<li><p>prediction precision:  <span class="math notranslate nohighlight">\(\hat{\pi}\)</span></p></li>
<li><p>surprise</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get beliefs trajectories from the agent</span>
<span class="n">trajectories</span> <span class="o">=</span> <span class="n">hgf</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">trajectories</span> <span class="o">=</span> <span class="n">trajectories</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;time_steps&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">trajectories</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>observation</th>
      <th>x_1_mu</th>
      <th>x_1_pi</th>
      <th>x_1_muhat</th>
      <th>x_1_pihat</th>
      <th>x_1_surprise</th>
      <th>x_2_mu</th>
      <th>x_2_pi</th>
      <th>x_2_muhat</th>
      <th>x_2_pihat</th>
      <th>x_2_surprise</th>
      <th>surprise</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.387</td>
      <td>7.387000</td>
      <td>10244.500000</td>
      <td>7.387000</td>
      <td>244.498947</td>
      <td>NaN</td>
      <td>0.427208</td>
      <td>6.699697</td>
      <td>0.500000</td>
      <td>6.676144</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7.472</td>
      <td>7.469874</td>
      <td>10256.577148</td>
      <td>7.387000</td>
      <td>256.576599</td>
      <td>-0.947414</td>
      <td>0.492652</td>
      <td>5.863727</td>
      <td>0.427208</td>
      <td>5.023926</td>
      <td>-0.030151</td>
      <td>-0.977565</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7.635</td>
      <td>7.631119</td>
      <td>10240.712891</td>
      <td>7.469874</td>
      <td>240.711533</td>
      <td>6.035478</td>
      <td>0.837745</td>
      <td>7.473376</td>
      <td>0.492652</td>
      <td>4.538707</td>
      <td>0.535200</td>
      <td>6.570678</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.224</td>
      <td>7.230870</td>
      <td>10171.632812</td>
      <td>7.631119</td>
      <td>171.632126</td>
      <td>5.453125</td>
      <td>1.541305</td>
      <td>18.525702</td>
      <td>0.837745</td>
      <td>5.446760</td>
      <td>2.658163</td>
      <td>8.111288</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6.147</td>
      <td>6.156204</td>
      <td>10085.648438</td>
      <td>7.230870</td>
      <td>85.647461</td>
      <td>187.365509</td>
      <td>2.380432</td>
      <td>57.856964</td>
      <td>1.541305</td>
      <td>9.637056</td>
      <td>6.552755</td>
      <td>193.918259</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># join the beliefs and observation</span>
<span class="n">trajectories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">aarhus_weather_df</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">trajectories</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">trajectories</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
<span class="n">trajectories</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>t2m</th>
      <th>prectotland</th>
      <th>precsnoland</th>
      <th>snomas</th>
      <th>rhoa</th>
      <th>swgdn</th>
      <th>swtdn</th>
      <th>cldtot</th>
      <th>observation</th>
      <th>...</th>
      <th>x_1_pi</th>
      <th>x_1_muhat</th>
      <th>x_1_pihat</th>
      <th>x_1_surprise</th>
      <th>x_2_mu</th>
      <th>x_2_pi</th>
      <th>x_2_muhat</th>
      <th>x_2_pihat</th>
      <th>x_2_surprise</th>
      <th>surprise</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-01-01 00:00:00</td>
      <td>7.387</td>
      <td>0.124</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.249</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.931</td>
      <td>7.387</td>
      <td>...</td>
      <td>10244.500000</td>
      <td>7.387000</td>
      <td>244.498947</td>
      <td>NaN</td>
      <td>0.427208</td>
      <td>6.699697</td>
      <td>0.500000</td>
      <td>6.676144</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-01-01 01:00:00</td>
      <td>7.472</td>
      <td>0.200</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.247</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.865</td>
      <td>7.472</td>
      <td>...</td>
      <td>10256.577148</td>
      <td>7.387000</td>
      <td>256.576599</td>
      <td>-0.947414</td>
      <td>0.492652</td>
      <td>5.863727</td>
      <td>0.427208</td>
      <td>5.023926</td>
      <td>-0.030151</td>
      <td>-0.977565</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-01-01 02:00:00</td>
      <td>7.635</td>
      <td>0.196</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.244</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.701</td>
      <td>7.635</td>
      <td>...</td>
      <td>10240.712891</td>
      <td>7.469874</td>
      <td>240.711533</td>
      <td>6.035478</td>
      <td>0.837745</td>
      <td>7.473376</td>
      <td>0.492652</td>
      <td>4.538707</td>
      <td>0.535200</td>
      <td>6.570678</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-01-01 03:00:00</td>
      <td>7.224</td>
      <td>0.061</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.245</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.387</td>
      <td>7.224</td>
      <td>...</td>
      <td>10171.632812</td>
      <td>7.631119</td>
      <td>171.632126</td>
      <td>5.453125</td>
      <td>1.541305</td>
      <td>18.525702</td>
      <td>0.837745</td>
      <td>5.446760</td>
      <td>2.658163</td>
      <td>8.111288</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-01-01 04:00:00</td>
      <td>6.147</td>
      <td>0.018</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.250</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.128</td>
      <td>6.147</td>
      <td>...</td>
      <td>10085.648438</td>
      <td>7.230870</td>
      <td>85.647461</td>
      <td>187.365509</td>
      <td>2.380432</td>
      <td>57.856964</td>
      <td>1.541305</td>
      <td>9.637056</td>
      <td>6.552755</td>
      <td>193.918259</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aggregate over one day</span>
<span class="n">trajectories</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">trajectories</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s2">&quot;x_1_mu&quot;</span><span class="p">,</span> <span class="s2">&quot;prectotland&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_1_mu</th>
      <th>prectotland</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>131.603577</td>
      <td>0.714</td>
    </tr>
    <tr>
      <th>1</th>
      <td>39.268307</td>
      <td>0.023</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11.851880</td>
      <td>0.042</td>
    </tr>
    <tr>
      <th>3</th>
      <td>108.671432</td>
      <td>0.113</td>
    </tr>
    <tr>
      <th>4</th>
      <td>118.146599</td>
      <td>0.057</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>360</th>
      <td>0.000000</td>
      <td>0.122</td>
    </tr>
    <tr>
      <th>361</th>
      <td>0.000000</td>
      <td>0.065</td>
    </tr>
    <tr>
      <th>362</th>
      <td>0.000000</td>
      <td>0.104</td>
    </tr>
    <tr>
      <th>363</th>
      <td>0.000000</td>
      <td>0.783</td>
    </tr>
    <tr>
      <th>364</th>
      <td>0.000000</td>
      <td>0.028</td>
    </tr>
  </tbody>
</table>
<p>365 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1 - create a decision function: based on the beliefs over the previous hour/day/week, decide e.g. if the agent should carry an umbrella</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2 - create an outcome function: based on the parameters that were recorded in the main data frame, what was the outcome (e.g. raining or not?)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3 - compute the surprise: how surprised are the agents if it was raining and no umbrella etc...</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#theory-modeling-belief-updating-under-uncertainty">Theory: Modeling belief updating under uncertainty</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-random-walks">Gaussian random walks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#volatility-coupling">Volatility coupling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-continuous-hgf">The continuous HGF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-optimization">Parameters optimization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice-filtering-the-worlds-weather-to-optimize-behavior">Practice: Filtering the worlds weather to optimize behavior</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-an-agent">Creating an agent</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/notebooks/Exercise_1_Using_the_HGF.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2022-2023, Nicolas Legrand.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>